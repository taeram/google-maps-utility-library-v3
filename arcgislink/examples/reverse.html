<html>
    <head>
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
        <title>Geocode</title>
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false">
        </script>
        <script type="text/javascript">
            document.write('<script type="text/javascript" src="../src/arcgislink' + (document.location.search.indexOf('packed') > -1 ? '_packed' : document.location.search.indexOf('compiled') > -1 ? '_compiled' : document.location.search.indexOf('compressed') > -1 ? '_compressed' : '') + '.js"><' + '/script>');
        </script>
        <script type="text/javascript">
            var map, geocoder, iw;
            function init() {
              var myOptions = {
                zoom: 17,
                center: new google.maps.LatLng(35.23, -80.84),
                mapTypeId: google.maps.MapTypeId.ROADMAP
              }
              map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
              geocoder = new gmaps.ags.GeocodeService('http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Locators/ESRI_Geocode_USA/GeocodeServer');
              
              marker = new google.maps.Marker({
                position: map.getCenter(),
                draggable: true
              });
              marker.setMap(map);
              google.maps.event.addListener(map, 'click', function(evt) {
                reverseGeocode(evt.latLng);
              });
              google.maps.event.addListener(marker, 'dragend', function(evt) {
                reverseGeocode(evt.latLng);
              });
              google.maps.event.addListener(marker, 'dragstart', function(evt) {
                iw.close();
              });
              iw = new google.maps.InfoWindow({
                maxWidth: 180,
                content: 'Click map or drag marker to get the address of the location'
              });
              iw.bindTo('position', marker, 'position');
              iw.open(map);
            }
            
            function reverseGeocode(latlng) {
              if (latlng) {
                var params = {
                  location: latlng,
                  distance: 100
                }
                geocoder.reverseGeocode(params, function(result) {
                  if (result.address) {
                    var html = '';
                    var attrs = result.address;
                    for (var x in attrs) {
                      if (attrs.hasOwnProperty(x)) {
                        html += x + ': ' + attrs[x] + '<br/>';
                      }
                    }
                    marker.setPosition(result.location);
                    iw.setContent(html);
                    iw.open(map);
                  } else {
                    alert('can not find address for point:' + latlng.toString());
                  }
                });
              }
              
            }
        </script>
    </head>
    <body style="margin:0px; padding:0px;" onload="init()">
        <div id="map_canvas" style="width:100%; height:100%">
        </div>
    </body>
</html>
